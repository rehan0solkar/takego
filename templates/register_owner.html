<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Register Owner| Canteen System</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/static/css/auth.css" rel="stylesheet">
</head>
<body>
<div class="auth-container">
    <div class="auth-card">
        <h2 class="text-center mb-4">Owner Register</h2>
        <div id="errorBox" class="alert alert-danger d-none"></div>
        <form id="registerForm" enctype="multipart/form-data" class="form inline">
            <input class="form-control mb-3" type="text" name="username" placeholder="Username" required>
            <input class="form-control mb-3" type="password" name="password" placeholder="Password (min 8 chars)" required>
            <input class="form-control mb-3" type="text" name="stall_name" placeholder="Stall Name" required>

            <hr>

            <h4>Initial Product</h4>
            <input class="form-control mb-3" type="text" name="product_name" placeholder="Product Name" required>
            <input class="form-control mb-3" type="number" name="price" placeholder="Price" min="1" required>
            <input class="form-control mb-3" type="number" name="prep_time" placeholder="Preparation Time (mins)" min="1" required>
            <input class="form-control mb-3" type="number" name="availability" placeholder="Availability" min="1" required>
            <label class="upload-box">
  <span class="upload-left">
    <strong id="uploadTitle">Product Image</strong>
    <small id="uploadSub">PNG / JPG</small>
  </span>

  <u><span class="upload-right" id="uploadStatus">
    Browse
  </span></u>

  <input
    type="file"
    name="product_image"
    id="productImage"
    accept="image/*"
    hidden
  >  
            </label><br>
            <button type="submit" class="btn btn-success w-100">Register & Create Stall</button>
        </form>

        <p class="text-center mt-3">
            Already registered?
            <a href="/login">Login</a>
        </p>
    </div>
</div>
<script>
const input = document.getElementById("productImage");
const title = document.getElementById("uploadTitle");
const sub = document.getElementById("uploadSub");
const box = document.querySelector(".upload-box");
const status = document.getElementById("uploadStatus");

input.addEventListener("change", () => {
  if (input.files.length > 0) {
    title.textContent = "Product image added";
    sub.textContent = input.files[0].name;
    status.textContent = "Uploaded";
    box.classList.add("uploaded");
  }
});
document.getElementById("registerForm")
  .addEventListener("submit", async (e) => {
    e.preventDefault();
    const formData = new FormData(e.target);

    const res = await fetch("/register_owner", {
      method: "POST",
      body: formData,
      credentials: "same-origin"
    });

    const data = await res.json();

    if (!data.success) {
      document.getElementById("errorBox").innerText = data.error;
      document.getElementById("errorBox").classList.remove("d-none");
      return;
    }

    window.location.href = data.redirect;
});
</script>
</body>
</html>
